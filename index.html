<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Seni Seviyorum</title>

<style>
  body {
    margin: 0;
    background: #ffe6f0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  }

  canvas { background: transparent; }

  /* Mesaj katmanÄ± */
  .overlay {
    position: fixed;
    inset: 0;
    display: none;
    justify-content: center;
    align-items: center;
    pointer-events: none;
    z-index: 10;
  }

  .msg {
    padding: 20px 30px;
    border-radius: 20px;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
    color: #7a0026;
    font-size: 32px;
    font-weight: 800;
    text-align: center;
    line-height: 1.4;
    animation: fadeIn 0.6s ease;
    max-width: min(820px, 92vw);
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to   { opacity: 1; transform: translateY(0); }
  }
</style>
</head>

<body>

<div class="overlay" id="overlay">
  <div class="msg" id="messageBox"></div>
</div>

<canvas id="canvas" width="650" height="650"></canvas>

<script>
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  const overlay = document.getElementById("overlay");
  const messageBox = document.getElementById("messageBox");

  // Kalp bittikten sonra final mesajdan Ã¶nce bekleme (ms)
  const T2_AFTER_HEART_DONE = 600;

  // Son mesaj (URL ile deÄŸiÅŸtirilebilir)
  const urlParams = new URLSearchParams(window.location.search);
  const finalMsg =
    urlParams.get("msg") ||
    "iyi ki doÄŸdun annecim\nnice yÄ±llara\nseni Ã§ok seviyorum ðŸ’–";

  function setOverlayText(text) {
    messageBox.innerHTML = text
      .split("\n")
      .map(line => `<div>${line}</div>`)
      .join("");
  }

  function showOverlay(text) {
    setOverlayText(text);
    overlay.style.display = "flex";
  }

  // === KALP ANÄ°MASYONU ===
  const SCALE_BASE = 16;
  const CENTER_X = canvas.width / 2;
  const CENTER_Y = canvas.height / 2 + 40;

  let t = 0;
  let points = [];
  let phase = "drawing"; // direkt Ã§izimle baÅŸla
  let beat = 0;
  let finalShown = false;

  function heart(tt) {
    return {
      x: 16 * Math.pow(Math.sin(tt), 3),
      y: 13 * Math.cos(tt)
        - 5 * Math.cos(2 * tt)
        - 2 * Math.cos(3 * tt)
        - Math.cos(4 * tt)
    };
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const pulse = (phase === "done")
      ? (1 + Math.sin(beat) * 0.04)
      : 1;

    ctx.save();
    ctx.translate(CENTER_X, CENTER_Y);
    ctx.scale(pulse, pulse);

    ctx.beginPath();
    for (let i = 0; i < points.length; i++) {
      const p = points[i];
      const x = p.x * SCALE_BASE;
      const y = -p.y * SCALE_BASE;
      if (i === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    }

    ctx.strokeStyle = "#d6003b";
    ctx.lineWidth = 3;
    ctx.lineJoin = "round";
    ctx.lineCap = "round";
    ctx.stroke();

    if (phase === "done") {
      ctx.font = "800 34px 'Comic Sans MS', cursive";
      ctx.fillStyle = "#800020";
      ctx.textAlign = "center";
      ctx.fillText("seni seviyorum", 0, 20);
      ctx.font = "800 28px 'Comic Sans MS', cursive";
      ctx.fillText("iyi ki varsÄ±n", 0, 60);
    }

    ctx.restore();
  }

  function animate() {
    if (phase === "drawing") {
      if (t < Math.PI * 2) {
        points.push(heart(t));
        t += 0.045;
      } else {
        phase = "done";
      }
    }

    if (phase === "done") {
      beat += 0.08;

      if (!finalShown) {
        finalShown = true;
        setTimeout(() => {
          showOverlay(finalMsg);
        }, T2_AFTER_HEART_DONE);
      }
    }

    draw();
    requestAnimationFrame(animate);
  }

  requestAnimationFrame(animate);
</script>

</body>
</html>
